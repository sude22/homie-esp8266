



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="The Homie for ESP8266 documentation.">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.0">
    
    
      
        <title>Advanced usage - Homie for ESP8266</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.1b62728e.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#ef5350">
      
    
    
      <script src="../assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="red" data-md-color-accent="red">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#advanced-usage" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Homie for ESP8266" class="md-header-nav__button md-logo">
          
            <img src="../assets/logo.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Homie for ESP8266
            </span>
            <span class="md-header-nav__topic">
              
                Advanced usage
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/homieiot/homie-esp8266/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    homieiot/homie-esp8266
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

<nav class="md-tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href=".." class="md-tabs__link md-tabs__link--active">
        Welcome
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../quickstart/what-is-it.md" class="md-tabs__link">
          Quickstart
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../advanced-usage/built-in-led.md" class="md-tabs__link">
          Advanced usage
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../configuration/json-configuration-file.md" class="md-tabs__link">
          Configuration
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../others/ota-configuration-updates.md" class="md-tabs__link">
          Others
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Homie for ESP8266" class="md-nav__button md-logo">
      
        <img src="../assets/logo.png" width="48" height="48">
      
    </a>
    Homie for ESP8266
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/homieiot/homie-esp8266/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    homieiot/homie-esp8266
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Welcome" class="md-nav__link">
      Welcome
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Quickstart
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Quickstart
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../quickstart/what-is-it.md" title="What is it?" class="md-nav__link">
      What is it?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../quickstart/getting-started.md" title="Getting started" class="md-nav__link">
      Getting started
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Advanced usage
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Advanced usage
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../advanced-usage/built-in-led.md" title="Built-in LED" class="md-nav__link">
      Built-in LED
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../advanced-usage/branding.md" title="Branding" class="md-nav__link">
      Branding
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../advanced-usage/events.md" title="Events" class="md-nav__link">
      Events
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../advanced-usage/logging.md" title="Logging" class="md-nav__link">
      Logging
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../advanced-usage/streaming-operator.md" title="Streaming operator" class="md-nav__link">
      Streaming operator
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../advanced-usage/input-handlers.md" title="Input handlers" class="md-nav__link">
      Input handlers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../advanced-usage/broadcast.md" title="Broadcast" class="md-nav__link">
      Broadcast
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../advanced-usage/custom-settings.md" title="Custom settings" class="md-nav__link">
      Custom settings
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../advanced-usage/resetting.md" title="Resetting" class="md-nav__link">
      Resetting
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../advanced-usage/compiler-flags.md" title="Compiler-Flags" class="md-nav__link">
      Compiler-Flags
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../advanced-usage/standalone-mode.md" title="Standalone mode" class="md-nav__link">
      Standalone mode
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../advanced-usage/magic-bytes.md" title="Magic bytes" class="md-nav__link">
      Magic bytes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../advanced-usage/range-properties.md" title="Range properties" class="md-nav__link">
      Range properties
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../advanced-usage/deep-sleep.md" title="Deep sleep" class="md-nav__link">
      Deep sleep
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../advanced-usage/miscellaneous.md" title="Miscellaneous" class="md-nav__link">
      Miscellaneous
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../advanced-usage/ui-bundle.md" title="UI Bundle" class="md-nav__link">
      UI Bundle
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Configuration
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Configuration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../configuration/json-configuration-file.md" title="JSON configuration file" class="md-nav__link">
      JSON configuration file
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../configuration/http-json-api.md" title="HTTP JSON API" class="md-nav__link">
      HTTP JSON API
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Others
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Others
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../others/ota-configuration-updates.md" title="OTA/configuration updates" class="md-nav__link">
      OTA/configuration updates
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../others/homie-implementation-specifics.md" title="Homie implementation specifics" class="md-nav__link">
      Homie implementation specifics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../others/limitations-and-known-issues.md" title="Limitations and known issues" class="md-nav__link">
      Limitations and known issues
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../others/troubleshooting.md" title="Troubleshooting" class="md-nav__link">
      Troubleshooting
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../others/cpp-api-reference.md" title="C++ API reference" class="md-nav__link">
      C++ API reference
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../others/upgrade-guide-from-v1-to-v2.md" title="Upgrade guide from v1 to v2" class="md-nav__link">
      Upgrade guide from v1 to v2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../others/upgrade-guide-from-v2-to-v3.md" title="Upgrade guide from v2 to v3" class="md-nav__link">
      Upgrade guide from v2 to v3
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../others/community-projects.md" title="Community projects" class="md-nav__link">
      Community projects
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#built-in-led" class="md-nav__link">
    Built-in LED
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#change-the-brand" class="md-nav__link">
    Change the brand
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hook-to-homie-events" class="md-nav__link">
    Hook to Homie events
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#serial-logging" class="md-nav__link">
    Serial / Logging
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#input-handlers" class="md-nav__link">
    Input handlers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#homienode" class="md-nav__link">
    HomieNode
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reset" class="md-nav__link">
    Reset
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#know-if-device-is-in-normal-mode" class="md-nav__link">
    Know if device is in normal mode
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/homieiot/homie-esp8266/edit/master/docs/3.-Advanced-usage.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="advanced-usage">Advanced usage<a class="headerlink" href="#advanced-usage" title="Permanent link">&para;</a></h1>
<h2 id="built-in-led">Built-in LED<a class="headerlink" href="#built-in-led" title="Permanent link">&para;</a></h2>
<p>By default, Homie for ESP8266 will blink the built-in LED to indicate its status. However, on some boards like the ESP-01, the built-in LED is actually the TX port, so it is fine if Serial is not enabled, but if you enable Serial, this is a problem. You can easily disable the built-in LED blinking.</p>
<div class="codehilite"><pre><span></span><span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Homie</span><span class="p">.</span><span class="n">enableBuiltInLedIndicator</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span> <span class="c1">// before Homie.setup()</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>

<p>You may, instead of completely disable the LED control, set a new LED to control:</p>
<div class="codehilite"><pre><span></span><span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Homie</span><span class="p">.</span><span class="n">setLedPin</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span> <span class="c1">// before Homie.setup() -- 2nd param is the state when the LED is on</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>

<h2 id="change-the-brand">Change the brand<a class="headerlink" href="#change-the-brand" title="Permanent link">&para;</a></h2>
<p>By default, Homie for ESP8266 will spawn a <code class="codehilite"><span class="err">Homie-XXXXXXXX</span></code> AP, will connect to the MQTT broker with the <code class="codehilite"><span class="err">Homie-XXXXXXXX</span></code> client ID, etc. You might want to change the <code class="codehilite"><span class="err">Homie</span></code> text:</p>
<div class="codehilite"><pre><span></span><span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Homie</span><span class="p">.</span><span class="n">setBrand</span><span class="p">(</span><span class="s">&quot;MyIoTSystem&quot;</span><span class="p">);</span> <span class="c1">// before Homie.setup()</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>

<h2 id="hook-to-homie-events">Hook to Homie events<a class="headerlink" href="#hook-to-homie-events" title="Permanent link">&para;</a></h2>
<p>You may want to hook to Homie events. Maybe you will want to blink a LED if the Wi-Fi connection is lost, or execute some code prior to a device reset to clear some EEPROM you're using.</p>
<div class="codehilite"><pre><span></span><span class="kt">void</span> <span class="nf">onHomieEvent</span><span class="p">(</span><span class="n">HomieEvent</span> <span class="n">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">switch</span><span class="p">(</span><span class="n">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nl">HOMIE_CONFIGURATION_MODE</span><span class="p">:</span>
      <span class="c1">// Do whatever you want when configuration mode is started</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nl">HOMIE_NORMAL_MODE</span><span class="p">:</span>
      <span class="c1">// Do whatever you want when normal mode is started</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nl">HOMIE_OTA_MODE</span><span class="p">:</span>
      <span class="c1">// Do whatever you want when OTA mode is started</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nl">HOMIE_ABOUT_TO_RESET</span><span class="p">:</span>
      <span class="c1">// Do whatever you want when the device is about to reset</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nl">HOMIE_WIFI_CONNECTED</span><span class="p">:</span>
      <span class="c1">// Do whatever you want when Wi-Fi is connected in normal mode</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nl">HOMIE_WIFI_DISCONNECTED</span><span class="p">:</span>
      <span class="c1">// Do whatever you want when Wi-Fi is disconnected in normal mode</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nl">HOMIE_MQTT_CONNECTED</span><span class="p">:</span>
      <span class="c1">// Do whatever you want when MQTT is connected in normal mode</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nl">HOMIE_MQTT_DISCONNECTED</span><span class="p">:</span>
      <span class="c1">// Do whatever you want when MQTT is disconnected in normal mode</span>
      <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Homie</span><span class="p">.</span><span class="n">onEvent</span><span class="p">(</span><span class="n">onHomieEvent</span><span class="p">);</span> <span class="c1">// before Homie.setup()</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>

<p>See the <code class="codehilite"><span class="err">HookToEvents</span></code> example for a concrete use case.</p>
<h2 id="serial-logging">Serial / Logging<a class="headerlink" href="#serial-logging" title="Permanent link">&para;</a></h2>
<p>By default, Homie for ESP8266 will output a lot of useful debug messages on the Serial. You may want to disable this behavior if you want to use the Serial line for anything else.</p>
<div class="codehilite"><pre><span></span><span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Homie</span><span class="p">.</span><span class="n">enableLogging</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span> <span class="c1">// before Homie.setup()</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>

<p>If logging is enabled <code class="codehilite"><span class="err">Serial.begin();</span></code> will be called internally at 115 200 baud in <code class="codehilite"><span class="err">Homie.setup()</span></code>. So don't initialize the Serial line yourself.</p>
<h2 id="input-handlers">Input handlers<a class="headerlink" href="#input-handlers" title="Permanent link">&para;</a></h2>
<p>There are three types of input handlers:</p>
<ul>
<li>Global input handler. This unique handler will handle every changed subscribed properties for all registered nodes</li>
</ul>
<p><div class="codehilite"><pre><span></span><span class="kt">bool</span> <span class="nf">globalInputHandler</span><span class="p">(</span><span class="n">String</span> <span class="n">node</span><span class="p">,</span> <span class="n">String</span> <span class="n">property</span><span class="p">,</span> <span class="n">String</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Homie</span><span class="p">.</span><span class="n">setGlobalInputHandler</span><span class="p">(</span><span class="n">globalInputHandler</span><span class="p">);</span> <span class="c1">// before Homie.setup()</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
* Node input handlers. This handler will handle every changed subscribed properties of a specific node</p>
<p><div class="codehilite"><pre><span></span><span class="kt">bool</span> <span class="nf">nodeInputHandler</span><span class="p">(</span><span class="n">String</span> <span class="n">property</span><span class="p">,</span> <span class="n">String</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>

<span class="n">HomieNode</span> <span class="nf">node</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span> <span class="s">&quot;type&quot;</span><span class="p">,</span> <span class="n">nodeInputHandler</span><span class="p">);</span>
</pre></div>
* Property input handlers. This handler will handle changes for a specific property of a specific node</p>
<div class="codehilite"><pre><span></span><span class="kt">bool</span> <span class="nf">propertyInputHandler</span><span class="p">(</span><span class="n">String</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>

<span class="n">HomieNode</span> <span class="nf">node</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span> <span class="s">&quot;type&quot;</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">node</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s">&quot;property&quot;</span><span class="p">,</span> <span class="n">propertyInputHandler</span><span class="p">);</span> <span class="c1">// before Homie.setup()</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>

<p>You can see that input handlers return a boolean. An input handler can decide whether or not it handled the message and want to propagate it down to other input handlers. If an input handler returns <code class="codehilite"><span class="err">true</span></code>, the propagation is stopped, if it returns <code class="codehilite"><span class="err">false</span></code>, the propagation continues. The order of the propagation is global handler → node handler → property handler.</p>
<p>For example, imagine you defined three input handlers: the global one, the node one, and the property one. If the global input handler returns <code class="codehilite"><span class="err">false</span></code>, the node input handler will be called. If the node input handler returns <code class="codehilite"><span class="err">true</span></code>, the propagation is stopped and the property input handler won't be called.</p>
<h2 id="homienode">HomieNode<a class="headerlink" href="#homienode" title="Permanent link">&para;</a></h2>
<p>You might want to create a node that subscribes to all properties. Just add a fourth parameter to the <code class="codehilite"><span class="err">HomieNode</span></code> constructor, set to <code class="codehilite"><span class="err">true</span></code>:</p>
<div class="codehilite"><pre><span></span><span class="kt">bool</span> <span class="nf">nodeInputHandler</span><span class="p">(</span><span class="n">String</span> <span class="n">property</span><span class="p">,</span> <span class="n">String</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>

<span class="n">HomieNode</span> <span class="nf">node</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span> <span class="s">&quot;type&quot;</span><span class="p">,</span> <span class="n">nodeInputHandler</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
</pre></div>

<p>See the <code class="codehilite"><span class="err">LedStrip</span></code> example for a concrete use case.</p>
<h2 id="reset">Reset<a class="headerlink" href="#reset" title="Permanent link">&para;</a></h2>
<p>Resetting the device means erasing the stored configuration and rebooting from <code class="codehilite"><span class="err">normal</span></code> mode to <code class="codehilite"><span class="err">configuration</span></code> mode. By default, you can do it by pressing 5 seconds the <code class="codehilite"><span class="err">FLASH</span></code> button of your ESP8266 board.</p>
<p>This behavior is configurable:</p>
<div class="codehilite"><pre><span></span><span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Homie</span><span class="p">.</span><span class="n">setResetTrigger</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">LOW</span><span class="p">,</span> <span class="mi">2000</span><span class="p">);</span> <span class="c1">// before Homie.setup()</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>

<p>The device will now reset if pin <code class="codehilite"><span class="err">1</span></code> is <code class="codehilite"><span class="err">LOW</span></code> for <code class="codehilite"><span class="err">2000</span></code>ms. You can also disable completely this reset trigger:</p>
<div class="codehilite"><pre><span></span><span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Homie</span><span class="p">.</span><span class="n">disableResetTrigger</span><span class="p">();</span> <span class="c1">// before Homie.setup()</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>

<p>In addition, you can also provide your own function responsible for the device reset. This function will be looped:</p>
<div class="codehilite"><pre><span></span><span class="kt">bool</span> <span class="nf">resetFunction</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nb">true</span><span class="p">;</span> <span class="c1">// If true is returned, the device will reset, if false, it won&#39;t</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Homie</span><span class="p">.</span><span class="n">setResetFunction</span><span class="p">(</span><span class="n">resetFunction</span><span class="p">);</span> <span class="c1">// before Homie.setup()</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>

<p>Sometimes, you might want to disable temporarily the ability to reset the device. For example, if your device is doing some background work like moving shutters, you will want to disable the ability to reset until the shutters are not moving anymore.</p>
<div class="codehilite"><pre><span></span><span class="n">Homie</span><span class="p">.</span><span class="n">setResettable</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
</pre></div>

<p>Note that if a reset is asked while <code class="codehilite"><span class="err">resettable</span></code> is set to false, the device will be flagged. In other words, when you will call <code class="codehilite"><span class="err">Homie.setResettable(true);</span></code> back, the device will immediately reset.</p>
<h2 id="know-if-device-is-in-normal-mode">Know if device is in normal mode<a class="headerlink" href="#know-if-device-is-in-normal-mode" title="Permanent link">&para;</a></h2>
<p>If, for some reason, you want to run some code in the Arduino <code class="codehilite"><span class="err">loop()</span></code> function, it might be useful for you to know if the device is in <code class="codehilite"><span class="err">normal</span></code> mode and if the network connection is up.</p>
<div class="codehilite"><pre><span></span><span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">Homie</span><span class="p">.</span><span class="n">isReadyToOperate</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">// normal mode and network connection up</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// not in normal mode or network connection down</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../assets/fonts/font-awesome.css">
    
      <a href="http://homieiot.github.io/homie-esp8266/configurators/v2/" class="md-footer-social__link fa fa-cog"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.808e90bb.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>